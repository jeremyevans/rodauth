<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>login_return.rdoc</title>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='file' id='wrapper'>
<div class='header'>
<h1 class='name'>login_return.rdoc
</h1>
<div class='paths'>
doc/guides/login_return.rdoc
</div>
<div class='last-update'>
Last Update:
<span class='datetime'>2020-06-30 15:06:09 -0700</span>
</div>
</div>
<div id='content'>
<div id='text'>
<div id='description'>
<h1 id="label-Redirect+to+original+page+after+login">Redirect to original page after login<span><a href="#label-Redirect+to+original+page+after+login">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>When the user attempts to open a page that requires authentication, <a href="../../../classes/Rodauth.html"><code>Rodauth</code></a> redirects them to the login page. It can be useful to redirect them back to the page they originally requested after successful login.  Similarly, you can do this for pages requiring multifactor authentication.</p>

<pre class="ruby"><span class="ruby-identifier">plugin</span> <span class="ruby-value">:rodauth</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">enable</span> <span class="ruby-value">:login</span>, <span class="ruby-value">:logout</span>, <span class="ruby-value">:otp</span>

  <span class="ruby-comment"># Have successful login redirect back to originally requested page</span>
  <span class="ruby-identifier">login_return_to_requested_location?</span> <span class="ruby-keyword">true</span>

  <span class="ruby-comment"># Have successful multifactor authentication redirect back to</span>
  <span class="ruby-comment"># originally requested page</span>
  <span class="ruby-identifier">two_factor_auth_return_to_requested_location?</span> <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span>
</pre>

<p>You can manually set which page to redirect after login or multifactor authentication, though it is questionable whether the user will desire this behavior compared to the default.</p>

<pre class="ruby"><span class="ruby-identifier">route</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">rodauth</span>

  <span class="ruby-comment"># Return the last visited path after login</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">rodauth</span>.<span class="ruby-identifier">logged_in?</span>
    <span class="ruby-comment"># Return to the last visited page after multifactor authentication</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">rodauth</span>.<span class="ruby-identifier">two_factor_authenticated?</span>
      <span class="ruby-identifier">session</span>[<span class="ruby-identifier">rodauth</span>.<span class="ruby-identifier">two_factor_auth_redirect_session_key</span>] = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">fullpath</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">session</span>[<span class="ruby-identifier">rodauth</span>.<span class="ruby-identifier">login_redirect_session_key</span>] = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">fullpath</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># rest of routes</span>
<span class="ruby-keyword">end</span>
</pre>
</div>
<div id='context'>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/jeremyevans/hanna-nouveau"><strong>Hanna Nouveau</strong> RDoc template</a>
</div>
</body>
</html>
