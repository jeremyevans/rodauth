<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>admin_activation.rdoc</title>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='file' id='wrapper'>
<div class='header'>
<h1 class='name'>admin_activation.rdoc
</h1>
<div class='paths'>
doc/guides/admin_activation.rdoc
</div>
</div>
<div id='content'>
<div id='text'>
<div id='description'>
<h1 id="label-Require+account+verification+by+admin">Require account verification by admin<span><a href="#label-Require+account+verification+by+admin">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>There are scenarios in which, instead of allowing the user to verify they have access to the email for the account, you may want to have an admin or moderator approve new accounts manually. One way this can be achieved by sending the account verification email to the admin:</p>

<pre class="ruby"><span class="ruby-identifier">plugin</span> <span class="ruby-value">:rodauth</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">enable</span> <span class="ruby-value">:login</span>, <span class="ruby-value">:logout</span>, <span class="ruby-value">:verify_account</span>, <span class="ruby-value">:reset_password</span>

  <span class="ruby-comment"># Send account verification email to the admin</span>
  <span class="ruby-identifier">email_to</span> <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">account</span>[<span class="ruby-identifier">account_status_column</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">account_unverified_status_value</span>
      <span class="ruby-string">&quot;admin@myapp.com&quot;</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">super</span>()
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Do not ask for password when creating or verifying account</span>
  <span class="ruby-identifier">verify_account_set_password?</span> <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">create_account_set_password?</span> <span class="ruby-keyword">false</span>

  <span class="ruby-comment"># Adjust the account verification email subject and body</span>
  <span class="ruby-identifier">verify_account_email_subject</span> <span class="ruby-string">&quot;New User Awaiting Admin Approval&quot;</span>
  <span class="ruby-identifier">verify_account_email_body</span> <span class="ruby-keyword">do</span>
    <span class="ruby-node">&quot;The user #{account[login_column]} has created an account. Click here to approve it: #{verify_account_email_link}.&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Display this message to the user after they&#39;ve created their account</span>
  <span class="ruby-identifier">verify_account_email_sent_notice_flash</span> <span class="ruby-string">&quot;Your account has been created and is awaiting approval&quot;</span>

  <span class="ruby-comment"># Prevent the admin from being logged in after confirming the account</span>
  <span class="ruby-identifier">verify_account_autologin?</span> <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">verify_account_notice_flash</span> <span class="ruby-string">&quot;The account has been approved&quot;</span>

  <span class="ruby-comment"># Send a reset password email after verifying the account.</span>
  <span class="ruby-comment"># This allows the user to choose the password for the account,</span>
  <span class="ruby-comment"># and also makes sure the user can only log in if they have</span>
  <span class="ruby-comment"># access to the email address for the account.</span>
  <span class="ruby-identifier">after_verify_account</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">generate_reset_password_key_value</span>
    <span class="ruby-identifier">create_reset_password_key</span>
    <span class="ruby-identifier">send_reset_password_email</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>
</div>
<div id='context'>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/jeremyevans/hanna"><strong>Hanna</strong> RDoc template</a>
</div>
</body>
</html>
