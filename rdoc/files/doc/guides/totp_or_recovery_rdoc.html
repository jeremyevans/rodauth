<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>totp_or_recovery.rdoc</title>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='file' id='wrapper'>
<div class='header'>
<h1 class='name'>totp_or_recovery.rdoc
</h1>
<div class='paths'>
doc/guides/totp_or_recovery.rdoc
</div>
</div>
<div id='content'>
<div id='text'>
<div id='description'>
<h1 id="label-Allow+recovery+code+on+TOTP+code+field">Allow recovery code on TOTP code field<span><a href="#label-Allow+recovery+code+on+TOTP+code+field">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>If using the otp feature, for convenience you might want to allow the user to enter the recovery code into the TOTP code field, instead of requiring they use the separate recovery codes form. You can implement this using the following configuration:</p>

<pre class="ruby"><span class="ruby-identifier">plugin</span> <span class="ruby-value">:rodauth</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">enable</span> <span class="ruby-value">:login</span>, <span class="ruby-value">:logout</span>, <span class="ruby-value">:otp</span>, <span class="ruby-value">:recovery_codes</span>

  <span class="ruby-identifier">before_otp_auth_route</span> <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">recovery_code_match?</span>(<span class="ruby-identifier">param</span>(<span class="ruby-identifier">otp_auth_param</span>))
      <span class="ruby-identifier">two_factor_authenticate</span>(<span class="ruby-string">&quot;recovery_code&quot;</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>
</div>
<div id='context'>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/jeremyevans/hanna"><strong>Hanna</strong> RDoc template</a>
</div>
</body>
</html>
