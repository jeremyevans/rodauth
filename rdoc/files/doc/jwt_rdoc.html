<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>jwt.rdoc</title>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='file' id='wrapper'>
<div class='header'>
<h1 class='name'>jwt.rdoc
</h1>
<div class='paths'>
doc/jwt.rdoc
</div>
</div>
<div id='content'>
<div id='text'>
<div id='description'>
<h1 id="label-Documentation+for+JWT+Feature">Documentation for JWT Feature<span><a href="#label-Documentation+for+JWT+Feature">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>The jwt feature adds support for JSON API access for all other features that ship with <a href="../../classes/Rodauth.html"><code>Rodauth</code></a>, using JWT (JSON Web Tokens) to hold the session information. It depends on the json feature.</p>

<p>In order to use this feature, you have to set the <code>jwt_secret</code> configuration option with the secret used to cryptographically protect the token.</p>

<p>To use this JSON API, when processing responses for requests to a <a href="../../classes/Rodauth.html"><code>Rodauth</code></a> endpoint, check for the Authorization header, and use the value of the response Authorization header as the request Authorization header in future requests, if the response Authorization header is set. If the response Authorization header is not set, then continue to use the previous Authorization header.</p>

<p>When using this feature, consider using the <code>json: :only</code> option when loading the rodauth plugin, if you want <a href="../../classes/Rodauth.html"><code>Rodauth</code></a> to only handle JSON requests.  If you don’t use the <code>json: :only</code> option, the jwt feature will probably result in an error if a request to a <a href="../../classes/Rodauth.html"><code>Rodauth</code></a> endpoint comes in with a Content-Type that isn’t application/json, unless you also set <code>only_json? false</code> in your rodauth configuration.</p>

<p>If you would like to check if a valid JWT was submitted with the current request in your Roda app, you can call the <code>rodauth.valid_jwt?</code> method.  If <code>rodauth.valid_jwt?</code> returns true, the contents of the jwt can be retrieved from <code>rodauth.session</code>.</p>

<p>Logging the session out does not invalidate the previous JWT token by default. If you would like this behavior, you can use the <a href="active_sessions_rdoc.html">active_sessions</a> feature, which stores session identifiers in the database and deletes them when the session expires. This provides a whitelist approach of revoking JWT tokens.</p>

<h2 id="label-Auth+Value+Methods">Auth Value Methods<span><a href="#label-Auth+Value+Methods">&para;</a> <a href="#top">&uarr;</a></span></h2>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>invalid_jwt_format_error_message </td><td>
<p>The error message to use when a JWT with an invalid format is submitted in the Authorization header.</p>
</td></tr><tr><td class='label'>jwt_algorithm </td><td>
<p>The JWT algorithm to use, <code>HS256</code> by default.</p>
</td></tr><tr><td class='label'>jwt_authorization_ignore </td><td>
<p>A regexp matched against the Authorization header, which skips JWT processing if it matches.  By default, HTTP Basic and Digest authentication are ignored.</p>
</td></tr><tr><td class='label'>jwt_authorization_remove </td><td>
<p>A regexp to remove from the Authorization header before processing the JWT.  By default, a Bearer prefix is removed.</p>
</td></tr><tr><td class='label'>jwt_decode_opts </td><td>
<p>An optional hash to pass to <code>JWT.decode</code>. Can be used to set JWT verifiers.</p>
</td></tr><tr><td class='label'>jwt_old_secret </td><td>
<p>The previous JWT secret used, to support JWT secret rotation (only supported when using jwt 2.4+).  Access to this should be protected the same as a session secret.</p>
</td></tr><tr><td class='label'>jwt_secret </td><td>
<p>The JWT secret to use.  Access to this should be protected the same as a session secret.</p>
</td></tr><tr><td class='label'>jwt_session_key </td><td>
<p>A key to nest the session hash under in the JWT payload.  nil by default, for no nesting.</p>
</td></tr><tr><td class='label'>jwt_symbolize_deeply? </td><td>
<p>Whether to symbolize the session hash deeply.  false by default.</p>
</td></tr><tr><td class='label'>use_jwt? </td><td>
<p>Whether to use the JWT in the Authorization header for authentication information.  If false, falls back to using the rack session. By default, the Authorization header is used if it is present, if <code>only_json?</code> is true, or if the request uses a json content type.</p>
</td></tr></tbody></table>

<h2 id="label-Auth+Methods">Auth Methods<span><a href="#label-Auth+Methods">&para;</a> <a href="#top">&uarr;</a></span></h2>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>jwt_session_hash </td><td>
<p>The session hash used to create the session_jwt. Can be used to set JWT claims.</p>
</td></tr><tr><td class='label'>jwt_token </td><td>
<p>Retrieve the JWT token from the request, by default taking it from the Authorization header.</p>
</td></tr><tr><td class='label'>session_jwt </td><td>
<p>An encoded JWT for the current session.</p>
</td></tr><tr><td class='label'>set_jwt_token(token) </td><td>
<p>Set the JWT token in the response, by default storing it in the Authorization header.</p>
</td></tr></tbody></table>
</div>
<div id='context'>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/jeremyevans/hanna"><strong>Hanna</strong> RDoc template</a>
</div>
</body>
</html>
