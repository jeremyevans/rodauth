<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>base.rdoc</title>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='file' id='wrapper'>
<div class='header'>
<h1 class='name'>base.rdoc
</h1>
<div class='paths'>
doc/base.rdoc
</div>
<div class='last-update'>
Last Update:
<span class='datetime'>2025-04-07 07:36:34 -0700</span>
</div>
</div>
<div id='content'>
<div id='text'>
<div id='description'>
<h1 id="label-Documentation+for+Base+Feature">Documentation for Base Feature<span><a href="#label-Documentation+for+Base+Feature">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>The base feature is automatically loaded when you use <a href="../../classes/Rodauth.html"><code>Rodauth</code></a>.  It contains shared functionality that is used by multiple features.</p>

<h2 id="label-Auth+Value+Methods">Auth Value Methods<span><a href="#label-Auth+Value+Methods">&para;</a> <a href="#top">&uarr;</a></span></h2>

<h3 id="label-Most+Commonly+Used">Most Commonly Used<span><a href="#label-Most+Commonly+Used">&para;</a> <a href="#top">&uarr;</a></span></h3>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>account_password_hash_column </td><td>
<p>Set if the password hash column is in the same table as the login.  If this is set, <a href="../../classes/Rodauth.html"><code>Rodauth</code></a> will check the password hash in ruby. This is often used if you are replacing a legacy authentication system with <a href="../../classes/Rodauth.html"><code>Rodauth</code></a>.</p>
</td></tr><tr><td class='label'>accounts_table </td><td>
<p>The database table containing the accounts.</p>
</td></tr><tr><td class='label'>base_url </td><td>
<p>The base URL to use, used when construct absolute links. It is recommended to set this if the application can be reached using arbitrary Host headers, as otherwise it is possible for an attacker to control the value.</p>
</td></tr><tr><td class='label'>db </td><td>
<p>The Sequel::Database object used for database access.</p>
</td></tr><tr><td class='label'>domain </td><td>
<p>The domain to use, required by some other features. It is recommended to set this if the application can be reached using arbitrary Host headers, as otherwise it is possible for an attacker to control the value.</p>
</td></tr><tr><td class='label'>hmac_secret </td><td>
<p>This sets the secret to use for all of Rodauth’s HMACs.  This is not set by default, in which case <a href="../../classes/Rodauth.html"><code>Rodauth</code></a> does not use HMACs for additional security.  However, it is highly recommended that you set this, and some features require it.</p>
</td></tr><tr><td class='label'>mark_input_fields_as_required? </td><td>
<p>Whether input fields should be marked as required, so browsers will not allow submission without filling out the field (default: true).</p>
</td></tr><tr><td class='label'>prefix </td><td>
<p>The routing prefix used for <a href="../../classes/Rodauth.html"><code>Rodauth</code></a> routes.  If you are calling in a routing subtree, this should be set to the root path of the subtree.  This should include a leading slash if set, but not a trailing slash.</p>
</td></tr><tr><td class='label'>require_bcrypt? </td><td>
<p>Set to false to not require bcrypt, useful if using custom authentication or when using the argon2 feature without existing bcrypt password hashes.</p>
</td></tr><tr><td class='label'>session_key </td><td>
<p>The key in the session hash storing the primary key of the logged in account.</p>
</td></tr><tr><td class='label'>session_key_prefix </td><td>
<p>The string that will be prepended to the default value for all session keys.</p>
</td></tr><tr><td class='label'>skip_status_checks? </td><td>
<p>Whether status checks should be skipped for accounts.  Defaults to true unless enabling the <a href="verify_account_rdoc.html">verify_account</a> or <a href="close_account_rdoc.html">close_account</a> features.</p>
</td></tr><tr><td class='label'>title_instance_variable </td><td>
<p>The instance variable to set in the Roda scope with the page title.  The layout should use this instance variable if available to set the title of the page.  You can use <code>set_title</code> if setting the page title is not done through an instance variable.</p>
</td></tr></tbody></table>

<h3 id="label-Other">Other<span><a href="#label-Other">&para;</a> <a href="#top">&uarr;</a></span></h3>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>account_id_column </td><td>
<p>The primary key column of the <code>accounts_table</code>.</p>
</td></tr><tr><td class='label'>account_open_status_value </td><td>
<p>The integer representing open accounts.</p>
</td></tr><tr><td class='label'>account_select </td><td>
<p>An array of columns to select from <code>accounts_table</code>. By default, selects all columns in the table.</p>
</td></tr><tr><td class='label'>account_status_column </td><td>
<p>The status id column in the <code>accounts_table</code>.</p>
</td></tr><tr><td class='label'>account_unverified_status_value </td><td>
<p>The integer representing unverified accounts.</p>
</td></tr><tr><td class='label'>authenticated_by_session_key </td><td>
<p>The key in the session hash storing an array of methods used to authenticate.</p>
</td></tr><tr><td class='label'>autocomplete_for_field?(param) </td><td>
<p>Whether to use an autocomplete attribute for the given parameter, defaults to <code>mark_input_fields_with_autocomplete?</code>.</p>
</td></tr><tr><td class='label'>autologin_type_session_key </td><td>
<p>The key in the session hash storing the type of autologin method used, if autologin was used to authenticate.</p>
</td></tr><tr><td class='label'>cache_templates </td><td>
<p>Whether to cache templates. True by default. It may be worth switching this to false in development if you are using your own templates instead of the templates provided by <a href="../../classes/Rodauth.html"><code>Rodauth</code></a>.</p>
</td></tr><tr><td class='label'>check_csrf? </td><td>
<p>Whether <a href="../../classes/Rodauth.html"><code>Rodauth</code></a> should use Roda’s <code>check_csrf!</code> method for checking CSRF tokens before dispatching to <a href="../../classes/Rodauth.html"><code>Rodauth</code></a> routes, true by default.</p>
</td></tr><tr><td class='label'>check_csrf_opts </td><td>
<p>Options to pass to Roda’s <code>check_csrf!</code> if <a href="../../classes/Rodauth.html"><code>Rodauth</code></a> calls it before dispatching.</p>
</td></tr><tr><td class='label'>check_csrf_block </td><td>
<p>Proc for block to pass to Roda’s <code>check_csrf!</code> if <a href="../../classes/Rodauth.html"><code>Rodauth</code></a> calls it before dispatching.</p>
</td></tr><tr><td class='label'>convert_token_id_to_integer? </td><td>
<p>Whether token ids should be converted to a valid 64-bit integer value.  If not set, defaults to true if <code>account_id_column</code> uses an integer type, and false otherwise.</p>
</td></tr><tr><td class='label'>default_field_attributes </td><td>
<p>The default attributes to use for input field tags, if field_attributes returns nil for the field.</p>
</td></tr><tr><td class='label'>default_redirect </td><td>
<p>Where to redirect after most successful actions.</p>
</td></tr><tr><td class='label'>field_attributes(field) </td><td>
<p>The attributes to use for the input field tags for the given field (parameter name).</p>
</td></tr><tr><td class='label'>field_error_attributes(field) </td><td>
<p>The attributes to use for the input field tags for the given field (parameter name), if the input has an error.</p>
</td></tr><tr><td class='label'>flash_error_key </td><td>
<p>The flash key to use for error messages (default: <code>:error</code> or <code>&#39;error&#39;</code> depending on session support for symbols).</p>
</td></tr><tr><td class='label'>flash_notice_key </td><td>
<p>The flash key to use for notice messages (default: <code>:notice</code> or <code>&#39;notice&#39;</code> depending on session support for symbols).</p>
</td></tr><tr><td class='label'>formatted_field_error(field, error) </td><td>
<p>HTML to use for error messages for the field (parameter name), if the field has an error.  By default, uses a span tag for the error message.</p>
</td></tr><tr><td class='label'>hmac_old_secret </td><td>
<p>This sets the previous secret used for Rodauth’s HMACs, to allow for secret rotation.</p>
</td></tr><tr><td class='label'>hook_action(hook_type, action) </td><td>
<p>Arbitrary action to take on all hook processing, with hook type being <code>:before</code> or <code>:after</code>, and action being symbol for related action.</p>
</td></tr><tr><td class='label'>input_field_error_class </td><td>
<p>The CSS class to use for input fields with errors. Can be a space separated string for multiple CSS classes.</p>
</td></tr><tr><td class='label'>input_field_error_message_class </td><td>
<p>The CSS class to use for error messages. Can be a space separated string for multiple CSS classes.</p>
</td></tr><tr><td class='label'>input_field_label_suffix </td><td>
<p>The suffix to use for all labels.  Useful for noting that the fields are required.</p>
</td></tr><tr><td class='label'>inputmode_for_field?(param) </td><td>
<p>Whether to use an inputmode attribute for the given parameter, defaults to mark_input_fields_with_inputmode?.</p>
</td></tr><tr><td class='label'>invalid_field_error_status </td><td>
<p>The response status to use for invalid field value errors, 422 by default.</p>
</td></tr><tr><td class='label'>invalid_key_error_status </td><td>
<p>The response status to use for invalid key codes, 401 by default.</p>
</td></tr><tr><td class='label'>invalid_password_error_status </td><td>
<p>The response status to use for invalid passwords, 401 by default.</p>
</td></tr><tr><td class='label'>invalid_password_message </td><td>
<p>The error message to display when a given password doesn’t match the stored password hash.</p>
</td></tr><tr><td class='label'>lockout_error_status </td><td>
<p>The response status to use a login is attempted to an account that is locked out, 403 by default.</p>
</td></tr><tr><td class='label'>login_column </td><td>
<p>The login column in the <code>accounts_table</code>.</p>
</td></tr><tr><td class='label'>login_input_type </td><td>
<p>The input type to use for logins. Defaults to email if login column is email and text otherwise.</p>
</td></tr><tr><td class='label'>login_label </td><td>
<p>The label to use for logins.</p>
</td></tr><tr><td class='label'>login_param </td><td>
<p>The parameter name to use for logins.</p>
</td></tr><tr><td class='label'>login_required_error_status </td><td>
<p>The response status to return when a login is required and you are not logged in, if not redirecting, 401 by default</p>
</td></tr><tr><td class='label'>login_uses_email? </td><td>
<p>Whether the login field uses email, used to set the type of the login field as well as the autocomplete setting.</p>
</td></tr><tr><td class='label'>mark_input_fields_with_autocomplete? </td><td>
<p>Whether input fields should be marked with autocomplete attribute appropriate for the field, true by default.</p>
</td></tr><tr><td class='label'>mark_input_fields_with_inputmode? </td><td>
<p>Whether input fields should be marked with inputmode attribute appropriate for the field, true by default.</p>
</td></tr><tr><td class='label'>max_param_bytesize </td><td>
<p>The maximum bytesize allowed for submitted parameters, 1024 by default. Use nil for no limit.</p>
</td></tr><tr><td class='label'>modifications_require_password? </td><td>
<p>Whether making changes to an account requires the user reinputing their password.  True by default if the account has a password.</p>
</td></tr><tr><td class='label'>no_matching_login_error_status </td><td>
<p>The response status to use when the login is not in the database, 401 by default.</p>
</td></tr><tr><td class='label'>no_matching_login_message </td><td>
<p>The error message to display when the login used is not in the database.</p>
</td></tr><tr><td class='label'>password_hash_column </td><td>
<p>The password hash column in the <code>password_hash_table</code>.</p>
</td></tr><tr><td class='label'>password_hash_id_column </td><td>
<p>The account id column in the <code>password_hash_table</code>.</p>
</td></tr><tr><td class='label'>password_hash_table </td><td>
<p>The table storing the password hashes.</p>
</td></tr><tr><td class='label'>password_label </td><td>
<p>The label to use for passwords.</p>
</td></tr><tr><td class='label'>password_param </td><td>
<p>The parameter name to use for passwords.</p>
</td></tr><tr><td class='label'>require_login_error_flash </td><td>
<p>The flash error to display when accessing a page that requires a login, when you are not logged in.</p>
</td></tr><tr><td class='label'>require_login_redirect </td><td>
<p>A redirect to the login page.</p>
</td></tr><tr><td class='label'>set_deadline_values? </td><td>
<p>Whether deadline values should be set.  True by default on MySQL, as that doesn’t support default values that are not constant.  Can be set to true on other databases if you want to vary the value based on a request parameter.</p>
</td></tr><tr><td class='label'>strftime_format </td><td>
<p>The format to pass to Time#strftime when formatting timestamps to display to the user, ‘%F %T’ by default.</p>
</td></tr><tr><td class='label'>template_opts </td><td>
<p>Any template options to pass to view/render.  This can be used to set a custom layout, for example.</p>
</td></tr><tr><td class='label'>token_separator </td><td>
<p>The string used to separate account id from the random key in links.</p>
</td></tr><tr><td class='label'>unmatched_field_error_status </td><td>
<p>The response status to use when two field values should match but do not, 422 by default.</p>
</td></tr><tr><td class='label'>unopen_account_error_status </td><td>
<p>The response status to use when trying to login to an account that isn’t open, 403 by default.</p>
</td></tr><tr><td class='label'>use_database_authentication_functions? </td><td>
<p>Whether to use functions to do authentication.  True by default on PostgreSQL, MySQL, and Microsoft SQL Server, false otherwise.</p>
</td></tr><tr><td class='label'>use_date_arithmetic? </td><td>
<p>Whether the date_arithmetic extension should be loaded into the database.  Defaults to whether deadline values should be set.</p>
</td></tr><tr><td class='label'>use_request_specific_csrf_tokens? </td><td>
<p>Whether to use request-specific CSRF tokens.  True if the default CSRF setting are used.</p>
</td></tr><tr><td class='label'>use_template_fixed_locals? </td><td>
<p>Whether to specify fixed locals for rodauth templates.  True by default, should only be set to false if overriding the templates and having them accept different local variables.</p>
</td></tr></tbody></table>

<h2 id="label-Auth+Methods">Auth Methods<span><a href="#label-Auth+Methods">&para;</a> <a href="#top">&uarr;</a></span></h2>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>account_from_id(id, status_id=nil) </td><td>
<p>Retrieve the account hash for the given account id and status.</p>
</td></tr><tr><td class='label'>account_from_login(login) </td><td>
<p>Retrieve the account hash related to the given login or nil if no login matches.</p>
</td></tr><tr><td class='label'>account_from_session </td><td>
<p>Retrieve the account hash related to the currently logged in session.</p>
</td></tr><tr><td class='label'>account_id </td><td>
<p>The primary key value of the current account.</p>
</td></tr><tr><td class='label'>account_session_value </td><td>
<p>The primary value of the current account to store in the session when logging in.</p>
</td></tr><tr><td class='label'>after_login </td><td>
<p>Run arbitrary code after a successful login.</p>
</td></tr><tr><td class='label'>after_login_failure </td><td>
<p>Run arbitrary code after a login failure due to an invalid password.</p>
</td></tr><tr><td class='label'>already_logged_in </td><td>
<p>What action to take if you are already logged in and attempt to access a page that only makes sense if you are not logged in.</p>
</td></tr><tr><td class='label'>around_rodauth(&amp;block) </td><td>
<p>Run arbitrary code around handling any rodauth route.  Call <code>super(&amp;block)</code> for <a href="../../classes/Rodauth.html"><code>Rodauth</code></a> to handle the action.</p>
</td></tr><tr><td class='label'>authenticated? </td><td>
<p>Whether the user has been authenticated. If multifactor authentication has been enabled for the account, this is true only if the session is multifactor authenticated.</p>
</td></tr><tr><td class='label'>before_login </td><td>
<p>Run arbitrary code after password has been checked, but before updating the session.</p>
</td></tr><tr><td class='label'>before_login_attempt </td><td>
<p>Run arbitrary code after an account has been located, but before the password has been checked.</p>
</td></tr><tr><td class='label'>before_rodauth </td><td>
<p>Run arbitrary code before handling any rodauth route, but after CSRF checks if <a href="../../classes/Rodauth.html"><code>Rodauth</code></a> is doing CSRF checks.</p>
</td></tr><tr><td class='label'>check_csrf </td><td>
<p>Checks CSRF token using Roda’s <code>check_csrf!</code> method.</p>
</td></tr><tr><td class='label'>clear_session </td><td>
<p>Clears the current session.</p>
</td></tr><tr><td class='label'>convert_token_id(id) </td><td>
<p>Convert the token id string to an appropriate object to use for the token id (or return <code>nil</code> to signal an invalid token id).  By default, converts to a 64-bit signed integer if <code>convert_token_id_to_integer?</code> is true.</p>
</td></tr><tr><td class='label'>csrf_tag(path=request.path) </td><td>
<p>The HTML fragment containing the CSRF tag to use, if any.</p>
</td></tr><tr><td class='label'>function_name(name) </td><td>
<p>The name of the database function to call.  It’s passed either :rodauth_get_salt or :rodauth_valid_password_hash.</p>
</td></tr><tr><td class='label'>logged_in? </td><td>
<p>Whether the current session is logged in.</p>
</td></tr><tr><td class='label'>login_required </td><td>
<p>Action to take when a login is required to access the page and the user is not logged in.</p>
</td></tr><tr><td class='label'>normalize_login(login) </td><td>
<p>How to normalize the submitted login parameter value, returns the argument by default.</p>
</td></tr><tr><td class='label'>null_byte_parameter_value(key, value) </td><td>
<p>The value to use for the parameter if the parameter includes an ASCII NUL byte (“0”), nil by default to ignore the parameter.</p>
</td></tr><tr><td class='label'>open_account? </td><td>
<p>Whether the current account is an open account (not closed or unverified).</p>
</td></tr><tr><td class='label'>over_max_bytesize_param_value(key, value) </td><td>
<p>The value to use for the parameter if the parameter is over the maximum allowed bytesize, nil by default to ignore the parameter.</p>
</td></tr><tr><td class='label'>password_match?(password) </td><td>
<p>Check whether the given password matches the stored password hash.</p>
</td></tr><tr><td class='label'>random_key </td><td>
<p>A randomly generated string, used for creating tokens.</p>
</td></tr><tr><td class='label'>redirect(path) </td><td>
<p>Redirect the request to the given path.</p>
</td></tr><tr><td class='label'>session_value </td><td>
<p>The value for session_key in the current session.</p>
</td></tr><tr><td class='label'>set_error_flash(message) </td><td>
<p>Set the current error flash to the given message.</p>
</td></tr><tr><td class='label'>set_error_reason(reason) </td><td>
<p>You can override this method to customize handling of specific error types (does nothing by default).  Each separate error type has a separate reason symbol, you can see the <a href="error_reasons_rdoc.html">list of error reason symbols</a>.</p>
</td></tr><tr><td class='label'>set_notice_flash(message) </td><td>
<p>Set the next notice flash to the given message.</p>
</td></tr><tr><td class='label'>set_notice_now_flash(message) </td><td>
<p>Set the current notice flash to the given message.</p>
</td></tr><tr><td class='label'>set_redirect_error_flash(message) </td><td>
<p>Set the next error flash to the given message.</p>
</td></tr><tr><td class='label'>set_title(title) </td><td>
<p>Set the title of the page to the given title.</p>
</td></tr><tr><td class='label'>translate(key, default_value) </td><td>
<p>Return a translated version for the key (uses the default value by default).</p>
</td></tr><tr><td class='label'>unverified_account_message </td><td>
<p>The message to use when attempting to login to an unverified account.</p>
</td></tr><tr><td class='label'>update_session </td><td>
<p>Clear the session, then set the session key to the primary key of the current account.</p>
</td></tr></tbody></table>
</div>
<div id='context'>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/jeremyevans/hanna"><strong>Hanna</strong> RDoc template</a>
</div>
</body>
</html>
