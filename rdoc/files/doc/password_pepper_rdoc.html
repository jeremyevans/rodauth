<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>password_pepper.rdoc</title>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='file' id='wrapper'>
<div class='header'>
<h1 class='name'>password_pepper.rdoc
</h1>
<div class='paths'>
doc/password_pepper.rdoc
</div>
</div>
<div id='content'>
<div id='text'>
<div id='description'>
<h1 id="label-Documentation+for+Password+Pepper+Feature">Documentation for Password Pepper Feature<span><a href="#label-Documentation+for+Password+Pepper+Feature">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>The password pepper feature appends a specified secret string to passwords before they are hashed. This way, if the password hashes get compromised, an attacker cannot use them to crack the passwords without also knowing the pepper.</p>

<p>In the configuration block set the <a href="password_pepper_rdoc.html">password_pepper</a> with your secret string. It’s recommended for the password pepper to be at last 32 characters long and randomly generated.</p>

<pre class="ruby"><span class="ruby-identifier">password_pepper</span> <span class="ruby-string">&quot;&lt;long secret key&gt;&quot;</span>
</pre>

<p>If your database already contains password hashes that were created without a password pepper, these will get automatically updated with a password pepper next time the user successfully enters their password.</p>

<p>If you’re using bcrypt (default), you should set <code>password_maximum_bytes</code> so that password + pepper don’t exceed 72 bytes. This is because bcrypt truncates passwords longer than 72 bytes, enabling an attacker to crack the pepper if the password bytesize is unlimited. If you’re using argon2, you should probably set <code>argon2_secret</code> instead of using this feature.</p>

<h2 id="label-Pepper+Rotation">Pepper Rotation<span><a href="#label-Pepper+Rotation">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>You can rotate the password pepper as well, just make sure to add the previous pepper to the <code>previous_password_peppers</code> array. Password hashes using the old pepper will get automatically updated on the next successful password match.</p>

<pre class="ruby"><span class="ruby-identifier">password_pepper</span> <span class="ruby-string">&quot;new pepper&quot;</span>
<span class="ruby-identifier">previous_password_peppers</span> [<span class="ruby-string">&quot;old pepper&quot;</span>, <span class="ruby-string">&quot;&quot;</span>]
</pre>

<p>The empty string above ensures password hashes without pepper are handled as well.</p>

<p>Note that each entry in <code>previous_password_peppers</code> will multiply the amount of possible password checks during login, at least for incorrect passwords.</p>

<p>Additionally, when using this feature with the <a href="disallow_password_reuse_rdoc.html">disallow_password_reuse</a> feature, the number of passwords checked when changing or resetting a password will be</p>

<pre class="ruby">(<span class="ruby-identifier">previous_password_peppers</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>) <span class="ruby-operator">*</span> <span class="ruby-identifier">previous_passwords_to_check</span>
</pre>

<p>So if you have 2 entries in <code>previous_password_peppers</code>, using the default value of 6 for <code>previous_passwords_to_check</code>, every time a password is changed, there will be 18 password checks done, which will be quite slow.</p>

<h2 id="label-Auth+Value+Methods">Auth Value Methods<span><a href="#label-Auth+Value+Methods">&para;</a> <a href="#top">&uarr;</a></span></h2>
<table class="rdoc-list note-list"><tbody><tr><td class='label'><a href="password_pepper_rdoc.html">password_pepper</a> </td><td>
<p>The secret string appended to passwords before they are hashed.</p>
</td></tr><tr><td class='label'>previous_password_peppers </td><td>
<p>An array of password peppers that will be tried on an unsuccessful password match. Defaults to <code>[&quot;&quot;]</code>, which allows introducing this feature with existing passwords.</p>
</td></tr><tr><td class='label'>password_pepper_update? </td><td>
<p>Whether to update password hashes that use a pepper from <code>previous_password_peppers</code> with a new pepper. Defaults to <code>true</code>.</p>
</td></tr></tbody></table>
</div>
<div id='context'>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/jeremyevans/hanna"><strong>Hanna</strong> RDoc template</a>
</div>
</body>
</html>
