<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>jwt_refresh.rdoc</title>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='file' id='wrapper'>
<div class='header'>
<h1 class='name'>jwt_refresh.rdoc
</h1>
<div class='paths'>
doc/jwt_refresh.rdoc
</div>
</div>
<div id='content'>
<div id='text'>
<div id='description'>
<h1 id="label-Documentation+for+JWT+Refresh+Feature">Documentation for JWT Refresh Feature<span><a href="#label-Documentation+for+JWT+Refresh+Feature">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>The <a href="jwt_refresh_rdoc.html">jwt_refresh</a> feature adds support for a database-backed JWT refresh token, setting a short lifetime on JWT access tokens.</p>

<p>When this feature is used, the access and refresh token are provided at login in the response body (the access token is still provided in the Authorization header), and for any subsequent POST to <code>/jwt-refresh</code>.</p>

<p>Note that using the refresh token invalidates the token and creates a new access token with an updated lifetime.  However, it does not invalidate older access tokens.  Older access tokens remain valid until they expire.  You can use the <a href="active_sessions_rdoc.html">active_sessions</a> feature if you want previous access tokens to be invalid as soon as the refresh token is used.</p>

<p>You can have multiple active refresh tokens active at a time, since each browser session will generally use a separate refresh token.  If you would like to revoke a refresh token when logging out, provide the refresh token when submitting the JSON request to logout. If you would like to remove all refresh tokens for the account when logging out, provide a value of <code>all</code> as the token value.</p>

<p>When using the refresh token, you must provide a valid access token, as that contains information about the current session, which is used to create the new access token. If you change the <code>allow_refresh_with_expired_jwt_access_token?</code> setting to <code>true</code>, an expired but otherwise valid access token will be accepted, and <a href="../../classes/Rodauth.html"><code>Rodauth</code></a> will check that the access token was issued in the same session as the refresh token.</p>

<p>This feature depends on the jwt feature.</p>

<h2 id="label-Auth+Value+Methods">Auth Value Methods<span><a href="#label-Auth+Value+Methods">&para;</a> <a href="#top">&uarr;</a></span></h2>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>allow_refresh_with_expired_jwt_access_token? </td><td>
<p>Whether refreshing should be allowed with an expired access token. Default is <code>false</code>.  You must set an <code>hmac_secret</code> if setting this value to <code>true</code>.</p>
</td></tr><tr><td class='label'>expired_jwt_access_token_status </td><td>
<p>The HTTP status code to use when a access token (JWT) is expired is submitted in the Authorization header. Default is 400 for backwards compatibility, and it is recommended to set it to 401.</p>
</td></tr><tr><td class='label'>expired_jwt_access_token_message </td><td>
<p>The error message to use when a access token (JWT) is expired is submitted in the Authorization header.</p>
</td></tr><tr><td class='label'>jwt_access_token_key </td><td>
<p>Name of the key in the response json holding the access token.  Default is <code>access_token</code>.</p>
</td></tr><tr><td class='label'>jwt_access_token_not_before_period </td><td>
<p>How many seconds before the current time will the jwt be considered valid (to account for inaccurate clocks). Default is 5.</p>
</td></tr><tr><td class='label'>jwt_access_token_period </td><td>
<p>Validity of an access token in seconds, default is 1800 (30 minutes).</p>
</td></tr><tr><td class='label'>jwt_refresh_route </td><td>
<p>The route to the login action. Defaults to <code>jwt-refresh</code>.</p>
</td></tr><tr><td class='label'>jwt_refresh_invalid_token_message </td><td>
<p>Error message when the provided refresh token is non existent, invalid or expired.</p>
</td></tr><tr><td class='label'>jwt_refresh_token_account_id_column </td><td>
<p>The column name in the <code>jwt_refresh_token_table</code> storing the account id, should be a foreign key referencing the accounts table.</p>
</td></tr><tr><td class='label'>jwt_refresh_token_data_session_key </td><td>
<p>The key in the session hash storing random data, for access checking during refresh if <code>allow_refresh_with_expired_jwt_access_token?</code> is set.</p>
</td></tr><tr><td class='label'>jwt_refresh_token_deadline_column </td><td>
<p>The column name in the <code>jwt_refresh_token_table</code> storing the deadline after which the refresh token will no longer be valid.</p>
</td></tr><tr><td class='label'>jwt_refresh_token_deadline_interval </td><td>
<p>Validity of a refresh token. Default is 14 days.</p>
</td></tr><tr><td class='label'>jwt_refresh_token_hmac_session_key </td><td>
<p>The key in the session hash storing the hmac, for access checking during refresh if <code>allow_refresh_with_expired_jwt_access_token?</code> is set.</p>
</td></tr><tr><td class='label'>jwt_refresh_token_id_column </td><td>
<p>The column name in the refresh token keys table storing the id of each token (the primary key of the table).</p>
</td></tr><tr><td class='label'>jwt_refresh_token_key </td><td>
<p>Name of the key in the response json holding the refresh token.  Default is <code>refresh_token</code>.</p>
</td></tr><tr><td class='label'>jwt_refresh_token_key_column </td><td>
<p>The column name in the <code>jwt_refresh_token_table</code> holding the refresh token key value.</p>
</td></tr><tr><td class='label'>jwt_refresh_token_key_param </td><td>
<p>Name of parameter in which the refresh token is provided when requesting a new token.  Default is <code>refresh_token</code>.</p>
</td></tr><tr><td class='label'>jwt_refresh_token_table </td><td>
<p>Name of the table holding refresh token keys.</p>
</td></tr><tr><td class='label'>jwt_refresh_without_access_token_message </td><td>
<p>Error message when trying to refresh with providing an access token.</p>
</td></tr><tr><td class='label'>jwt_refresh_without_access_token_status </td><td>
<p>The HTTP status code to use when trying to refresh without providing an access token.</p>
</td></tr></tbody></table>

<h2 id="label-Auth+Methods">Auth Methods<span><a href="#label-Auth+Methods">&para;</a> <a href="#top">&uarr;</a></span></h2>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>account_from_refresh_token(token) </td><td>
<p>Returns the account hash for the given refresh token.</p>
</td></tr><tr><td class='label'>after_refresh_token </td><td>
<p>Hooks for specific processing once the refresh token has been set.</p>
</td></tr><tr><td class='label'>before_jwt_refresh_route </td><td>
<p>Run arbitrary code before handling a <a href="jwt_refresh_rdoc.html">jwt_refresh</a> route.</p>
</td></tr><tr><td class='label'>before_refresh_token </td><td>
<p>Hooks for specific processing before the refresh token is computed.</p>
</td></tr></tbody></table>
</div>
<div id='context'>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/jeremyevans/hanna"><strong>Hanna</strong> RDoc template</a>
</div>
</body>
</html>
